const fileInput=document.getElementById("fileInput"),dropArea=document.getElementById("dropArea"),convertBtn=document.getElementById("convertBtn"),splitPreview=document.getElementById("splitPreview"),output=document.getElementById("output"),downloadZipBtn=document.getElementById("downloadZip"),formatSelect=document.getElementById("formatSelect"),scaleSelect=document.getElementById("scaleSelect"),jpegQualityInput=document.getElementById("jpegQuality"),zoomCache=new Map;let lastSplitPageCount=0;const mergeBtn=document.getElementById("mergePdfBtn");mergeBtn&&(mergeBtn.disabled=!0),convertBtn.disabled=!0,downloadZipBtn.disabled=!0;let removedPages=new Set,splitData=null,appMode=null,overlayLoader=null;function isAndroidWebView(){return"undefined"!=typeof window&&void 0!==window.AndroidDownloader}function showOverlayLoader(e="Processing…",t="Please wait…"){if(overlayLoader)return;let a=document.createElement("div");a.id="overlay-loader",Object.assign(a.style,{position:"fixed",inset:"0",background:"rgba(10, 12, 20, 0.72)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",zIndex:"999999",animation:"fadeIn 0.2s ease-out"});let l=document.createElement("div");Object.assign(l.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",borderRadius:"18px",padding:"32px 36px",minWidth:"300px",maxWidth:"90vw",textAlign:"center",color:"#e5e7eb",fontWeight:"700",letterSpacing:"0.3px"});let n=document.createElement("div");Object.assign(n.style,{width:"48px",height:"48px",borderRadius:"50%",border:"3px solid rgba(255,255,255,0.15)",borderTopColor:"var(--accent)",animation:"zoomSpin 0.85s linear infinite",margin:"0 auto 16px"});let r=document.createElement("div");r.textContent=e,r.style.marginBottom="6px";let o=document.createElement("small");o.textContent=t,Object.assign(o.style,{color:"#9ca3af",fontWeight:"600",display:"block"}),l.append(n,r,o),a.appendChild(l),document.body.appendChild(a),document.body.style.overflow="hidden",overlayLoader={overlay:a,subEl:o}}function updateOverlayLoader(e){overlayLoader&&(overlayLoader.subEl.textContent=e)}function hideOverlayLoader(){overlayLoader&&(overlayLoader.overlay.remove(),overlayLoader=null,document.body.style.overflow="")}function updateConvertBtnState(){convertBtn.disabled=0===currentFiles.length,updateSplitBtnState()}window.pdfjsLib&&(pdfjsLib.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.worker.min.js");let currentFiles=[],lastZipBlobUrl=null;const splitBtn=document.getElementById("splitBtn"),splitMode=document.getElementById("splitMode"),pageInput=document.getElementById("pageInput");function updateSplitBtnState(){if(!splitBtn)return;let e=1===currentFiles.length;splitBtn.disabled=!e,e||(splitOptions.style.display="none")}function handleFiles(e){downloadZipBtn.disabled=!0,downloadZipBtn.setAttribute("aria-disabled","true");let t=document.getElementById("mergePdfBtn");t&&(t.disabled=!0),resetSplitState();let a=new Map(currentFiles.map(e=>[e.name+"_"+e.size,!0]));e.forEach(e=>{a.has(e.name+"_"+e.size)||(currentFiles.push(e),a.set(e.name+"_"+e.size,!0))}),splitBtn&&splitBtn.addEventListener("click",()=>{splitOptions.style.display="none"}),splitMode&&splitMode.addEventListener("change",()=>{pageInput.style.display="all"===splitMode.value}),renderFileListSummary(),updateConvertBtnState()}function enableSplitReordering(){let e=Array.from(splitPreview.querySelectorAll(".page-wrapper")),t=null;e.forEach(e=>{e.draggable=!0,e.addEventListener("dragstart",a=>{t=e,e.classList.add("dragging"),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain","drag")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),t=null})}),splitPreview.addEventListener("dragover",e=>{if(!t)return;e.preventDefault();let a=function e(t,a){let l=[...t.querySelectorAll(".page-wrapper:not(.dragging)")],n={offset:Number.NEGATIVE_INFINITY,element:null};for(let r of l){let o=r.getBoundingClientRect(),i=a-(o.top+o.height/2);i<0&&i>n.offset&&(n={offset:i,element:r})}return n.element}(splitPreview,e.clientY);null==a?splitPreview.appendChild(t):splitPreview.insertBefore(t,a)});let a=null;function l(){a&&(a.classList.remove("dragging"),a=null,document.body.style.overflow="")}e.forEach(e=>{e.addEventListener("pointerdown",t=>{"mouse"!==t.pointerType&&(a=e,e.setPointerCapture(t.pointerId),e.classList.add("dragging"),document.body.style.overflow="hidden")}),e.addEventListener("pointermove",e=>{if(!a)return;let t=document.elementFromPoint(e.clientX,e.clientY)?.closest(".page-wrapper");if(!t||t===a)return;let l=t.getBoundingClientRect(),n=e.clientY>l.top+l.height/2;splitPreview.insertBefore(a,n?t.nextSibling:t)}),e.addEventListener("pointerup",l),e.addEventListener("pointercancel",l)})}function resetUploadedSourceOnly(){let e=output.querySelectorAll(".thumb.card");e.forEach(e=>e.remove()),currentFiles.length=0,fileInput.value="",convertBtn.disabled=!0,splitBtn.disabled=!0}function updateSplitDownloadState(){let e=splitPreview.querySelectorAll(".page-wrapper").length;downloadZipBtn.disabled=0===e,document.getElementById("mergePdfBtn").disabled=0===e}async function mergeSplitPagesToSinglePdf(){if(!splitData)return;let{sourcePdf:e,baseName:t,totalPages:a}=splitData,l=document.getElementById("mergePdfBtn");l.disabled=!0;try{let n=await PDFLib.PDFDocument.create(),r=Array.from(splitPreview.querySelectorAll(".page-wrapper")),o=0;for(let i of r){o++,updateOverlayLoader(`Adding page ${o} of ${r.length}`);let s=i.querySelector("div:last-child");if(!s)continue;let d=parseInt(s.textContent.replace("Page","").trim(),10)-1;if(isNaN(d)||d<0||d>=a||removedPages.has(d))continue;let[c]=await n.copyPages(e,[d]);n.addPage(c)}if(0===n.getPageCount()){showToast("No pages left to merge.","error");return}let p=await n.save(),m=new Blob([p],{type:"application/pdf"});if(isAndroidWebView())await saveBlobAndroid(m,`${t}_merged.pdf`,"application/pdf");else{let u=URL.createObjectURL(m),g=document.createElement("a");g.href=u,g.download=`${t}_merged.pdf`,g.style.display="none",document.body.appendChild(g),g.click(),g.remove(),setTimeout(()=>URL.revokeObjectURL(u),1e3)}showToast("Merged PDF downloaded.")}catch(y){console.error(y),showToast("Failed to merge PDF.","error")}finally{l.disabled=!1,hideOverlayLoader()}}function resetSplitState(){splitPreview.innerHTML="",splitPreview.style.display="none",splitData=null,removedPages.clear(),splitBtn.disabled=!1,splitBtn.textContent="Split PDF",splitBtn.style.opacity="",splitBtn.style.cursor=""}function renderFileListSummary(){if(splitBtn.disabled=!1,splitBtn.textContent="Split PDF",splitBtn.style.opacity="",splitBtn.style.cursor="",output.innerHTML="",!currentFiles.length){output.innerHTML='<div class="note">No files selected yet.</div>',updateConvertBtnState();return}currentFiles.forEach(e=>{let t=document.createElement("div");t.className="thumb card",t.style.padding="12px",t.style.display="flex",t.style.alignItems="center",t.style.gap="12px",t.innerHTML=`
         <!-- X REMOVE BUTTON -->
  <button class="remove-file-btn" style="
      position: absolute;
      top: 6px;
      right: 6px;
      background: #ff4d4d;
      color: white;
      border: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
  ">\xd7</button>
      <img src="./images/pdfIcon.jpg" class="pdf-icon" alt="PDF">
      <div class='meta-row'>
         <div class='pdfDetails'>${escapeHtml(e.name)}</div>
         <small style="font-weight: 500; padding:0 10px;">${(e.size/1024/1024).toFixed(2)} MB</small>
      </div>
    `,output.appendChild(t);let a=t.querySelector(".remove-file-btn");a.addEventListener("click",()=>{resetSplitState();let t=currentFiles.indexOf(e);t>-1&&currentFiles.splice(t,1),renderFileListSummary(),updateConvertBtnState()})}),updateConvertBtnState()}function clearUploadedFiles(){currentFiles.length=0,resetSplitState(),convertBtn.disabled=!0,splitBtn.disabled=!0}function escapeHtml(e){return String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}function showToast(e,t="success"){let a=document.getElementById("toastContainer"),l=document.createElement("div");l.className="toast","error"===t&&l.classList.add("error"),l.textContent=e,a.appendChild(l),setTimeout(()=>{l.remove()},7e3)}["dragenter","dragover"].forEach(e=>{dropArea.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation(),dropArea.classList.add("dragover")})}),["dragleave","drop"].forEach(e=>{dropArea.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation(),dropArea.classList.remove("dragover")})}),dropArea.addEventListener("drop",e=>{let t=e.dataTransfer;if(!t)return;let a=Array.from(t.files||[]).filter(e=>"application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf"));a.length&&handleFiles(a)}),dropArea.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),fileInput.click())}),fileInput.addEventListener("change",e=>handleFiles(Array.from(e.target.files||[]))),splitBtn.addEventListener("click",async()=>{if(showOverlayLoader("Splitting PDF","Rendering previews…"),1!==currentFiles.length){showToast("Please upload exactly ONE PDF to split.","error");return}appMode="split",splitBtn.disabled=!0,splitBtn.textContent="Splitting...",splitPreview.innerHTML="",splitPreview.style.display="grid",removedPages.clear();let e=createInlineLoader("Splitting PDF","Rendering page previews…");splitPreview.appendChild(e);try{let t=currentFiles[0],a=await t.arrayBuffer(),{PDFDocument:l}=PDFLib,n=await l.load(a),r=n.getPageCount();splitData={sourcePdf:n,totalPages:r,baseName:t.name.replace(/\.pdf$/i,""),splitMode:splitMode.value,pageInput:pageInput.value},downloadZipBtn.disabled=!1;let o=pdfjsLib.getDocument({data:a}),i=await o.promise;for(let s=1;s<=i.numPages;s++){e.querySelector("small").textContent=`Rendering page ${s} of ${i.numPages}`,updateOverlayLoader(`Rendering page ${s} of ${i.numPages}`);let d=s-1,c=await i.getPage(s),p=c.getViewport({scale:.4}),m=document.createElement("canvas"),u=m.getContext("2d");m.width=p.width,m.height=p.height,await c.render({canvasContext:u,viewport:p}).promise;let g=document.createElement("div");g.className="thumb page-wrapper",g.dataset.pageNumber=s,g._pdfJsDoc=i;let y=document.createElement("div");y.style.cssText="padding:6px;font-weight:700;text-align:center",y.textContent=`Page ${s}`;let v=document.createElement("button");v.className="delete-page-btn",v.innerHTML="\uD83D\uDDD1";let f=document.createElement("button");f.className="zoom-page-btn",f.textContent="\uD83D\uDC41️",f.onclick=()=>{let e=g.querySelector("canvas");e&&openZoomView(e)},v.onclick=()=>{removedPages.add(d),g.remove(),updateSplitDownloadState()},g.append(m,v,f,y),splitPreview.appendChild(g),enableSplitReordering()}e.remove(),document.getElementById("mergePdfBtn").disabled=!1,resetUploadedSourceOnly(),convertBtn.disabled=!0,splitBtn.disabled=!0,convertBtn.disabled=!0,splitBtn.disabled=!0,lastSplitPageCount=splitPreview.querySelectorAll(".page-wrapper").length,showToast(`Success! Split completed with ${lastSplitPageCount} page(s).`)}catch(h){console.error(h),showToast("Failed to split PDF","error")}finally{splitBtn.textContent="Split PDF",e&&e.remove(),hideOverlayLoader()}}),document.getElementById("mergePdfBtn").addEventListener("click",mergeSplitPagesToSinglePdf),convertBtn.addEventListener("click",async()=>{if(showOverlayLoader("Converting PDF","Preparing pages…"),appMode="convert",!currentFiles.length)return alert("Please add one or more PDF files first.");convertBtn.disabled=!0,convertBtn.textContent="Converting...",output.innerHTML="";let e=createInlineLoader("Converting PDF","Preparing documents…");if(output.appendChild(e),lastZipBlobUrl){try{URL.revokeObjectURL(lastZipBlobUrl)}catch(t){}lastZipBlobUrl=null}let a=new JSZip,l=formatSelect.value,n=Number(scaleSelect.value)||1,r=Number(jpegQualityInput.value)||.92;for(let o=0;o<currentFiles.length;o++){let i=currentFiles[o],s;try{s=await i.arrayBuffer()}catch(d){console.error("file read error",d);let c=document.createElement("div");c.className="thumb card",c.innerHTML=`<div style="font-weight:700">${escapeHtml(i.name)}</div><small style="color:#ff6b6b">Failed to read file</small>`,output.appendChild(c);continue}let p=pdfjsLib.getDocument({data:s}),m=null;try{m=await p.promise}catch(u){console.error("Error loading PDF",i.name,u);let g=document.createElement("div");g.className="thumb card",g.innerHTML=`<div style="font-weight:700">${escapeHtml(i.name)}</div><small style="color:#ff6b6b">Failed to open PDF</small>`,output.appendChild(g);continue}for(let y=1;y<=m.numPages;y++){e.querySelector("small").textContent=`Rendering page ${y} of ${m.numPages}`,updateOverlayLoader(`Rendering page ${y} of ${m.numPages}`);let v=await m.getPage(y),f=v.getViewport({scale:1}),h=document.createElement("canvas"),w=h.getContext("2d");h.width=Math.max(1,Math.floor(f.width*n)),h.height=Math.max(1,Math.floor(f.height*n));let b={canvasContext:w,viewport:v.getViewport({scale:n})};await v.render(b).promise,downloadZipBtn.disabled=!1,downloadZipBtn.removeAttribute("aria-disabled");let B=await new Promise(e=>h.toBlob(e,"jpeg"===l?"image/jpeg":"image/png",r)),E=i.name.replace(/\.pdf$/i,""),C=`${E}_page_${String(y).padStart(3,"0")}.${"jpeg"===l?"jpg":"png"}`;a.file(C,B);let P=document.createElement("div");P.className="thumb",P.style.position="relative";let L=URL.createObjectURL(B);P.innerHTML=`
  <img alt="${escapeHtml(C)}" src="${L}" />
  <div class="meta-row">
    <small title="${escapeHtml(C)}">${escapeHtml(C)}</small>
    <a class="download-btn" download="${escapeHtml(C)}" href="${L}">Download</a>
  </div>
`;let S=P.querySelector(".download-btn");S.onclick=async e=>{if(e.preventDefault(),isAndroidWebView()){let t=await fetch(L).then(e=>e.blob());await saveBlobAndroid(t,C,t.type)}else{let a=document.createElement("a");a.href=L,a.download=C,a.click()}};let $=document.createElement("button");$.className="zoom-page-btn",$.textContent="\uD83D\uDC41️",$.onclick=()=>{let e=P.querySelector("img");e&&openZoomView(e)},P.appendChild($),output.appendChild(P)}try{m.cleanup&&m.cleanup(),m.destroy&&m.destroy()}catch(x){}}convertBtn.textContent="Finalizing ZIP...";try{let F=await a.generateAsync({type:"blob",mimeType:"application/zip"});lastZipBlobUrl=URL.createObjectURL(F),downloadZipBtn.href=lastZipBlobUrl,downloadZipBtn.download=`pdf-images-${Date.now()}.zip`,downloadZipBtn.disabled=!1,downloadZipBtn.removeAttribute("aria-disabled"),intersactionAd(),showToast(`Success! Converted ${currentFiles.length} file(s) with a total of ${Array.from(output.querySelectorAll(".thumb")).length} page(s).`),clearUploadedFiles(),downloadZipBtn.disabled=!1,downloadZipBtn.disabled=!1,downloadZipBtn.removeAttribute("aria-disabled")}catch(I){console.error("zip error",I),showToast("Failed to create ZIP file.")}finally{convertBtn.textContent="Convert",e.remove(),hideOverlayLoader()}});const overlay=document.getElementById("overlay"),overlayClose=document.querySelector(".overlay-close"),overlayBody=document.querySelector(".overlay-body");function openOverlay(){overlay.style.display="flex",overlayBody.innerHTML=`

<p><strong>Effective Date:</strong> December 9, 2025</p>

<hr>

<h3>1. Overview</h3>
<p>
RemoPDF (“we”, “us”, “our”) provides a browser-based PDF-to-image conversion tool.
This document explains exactly what data is processed, what is not, and your legal rights.
If you do not agree, stop using the website immediately.
</p>

<h3>2. Local-Only File Processing</h3>
<p>
All PDF processing occurs <strong>entirely inside your browser</strong> using JavaScript and PDF.js.
</p>
<ul>
  <li>PDF files never leave your device</li>
  <li>No files are uploaded to our servers</li>
  <li>No files are stored, logged, or analyzed remotely</li>
  <li>Converted images remain under your control</li>
</ul>

<h3>3. Personal Information We Collect</h3>
<p>
We collect personal information <strong>only when you voluntarily submit it</strong> via the contact form.
</p>
<ul>
  <li>Name</li>
  <li>Email address</li>
  <li>Message content</li>
</ul>

<h3>How it is used</h3>
<ul>
  <li>Responding to inquiries</li>
  <li>Providing support</li>
  <li>Legal or operational communication</li>
</ul>

<p>
This data is <strong>not sold, rented, or shared</strong> for marketing purposes.
</p>

<h3>4. Third-Party Email Processing (EmailJS)</h3>
<p>
Contact form messages are transmitted using <strong>EmailJS</strong>, a third-party email delivery service.
</p>
<ul>
  <li>EmailJS temporarily processes submitted data to deliver messages</li>
  <li>Data is not used for advertising</li>
  <li>EmailJS operates under its own privacy policy</li>
</ul>

<p>
<strong>EmailJS Privacy Policy:</strong>
<a href="https://www.emailjs.com/legal/privacy-policy/" target="_blank" rel="noopener">View Policy</a>
</p>

<h3>5. Information We Do NOT Collect</h3>
<ul>
  <li>PDF files or converted images</li>
  <li>Payment details</li>
  <li>User accounts</li>
  <li>Browsing history</li>
  <li>Persistent tracking cookies</li>
</ul>

<h3>6. Advertising & Third-Party Scripts</h3>
<p>
RemoPDF displays third-party advertisements to support free usage.
</p>

<p>
Advertising partners may collect limited, non-personal technical data such as:
</p>
<ul>
  <li>Device type</li>
  <li>Browser type</li>
  <li>Approximate (non-precise) location</li>
  <li>Ad interaction metrics</li>
</ul>

<p>
Ads <strong>do not access</strong> your PDF files or browser-processed content.
</p>

<p>
<strong>Ad Provider:</strong> PropellerAds (or compatible ad networks)<br>
<strong>Privacy Policy:</strong>
<a href="https://propellerads.com/privacy/" target="_blank" rel="noopener">View Policy</a>
</p>

<h3>7. Cookies</h3>
<p>
RemoPDF does not use cookies for analytics or behavioral tracking.
</p>
<p>
Third-party advertisers may use cookies or similar technologies under their own policies.
</p>

<h3>8. Security</h3>
<p>
Because file processing is local, we do not store documents.
However, you are responsible for:
</p>
<ul>
  <li>Using a secure device</li>
  <li>Keeping your browser updated</li>
  <li>Trusting the network you connect from</li>
</ul>

<h3>9. Children’s Privacy</h3>
<p>
RemoPDF is not intended for children under 13.
We do not knowingly collect children’s personal information.
</p>

<h3>10. Your Rights</h3>
<p>
You may request:
</p>
<ul>
  <li>Access to your submitted data</li>
  <li>Correction or deletion</li>
  <li>Information about data usage</li>
</ul>

<p>
Contact us using the email below.
</p>

<h3>11. Changes</h3>
<p>
We may update this policy at any time.
Continued use means acceptance of the latest version.
</p>

<br/>
<hr>
<br/>

<h1>Terms & Conditions</h1>

<h3>1. Acceptance</h3>
<p>
Using RemoPDF means you agree to these terms.
If not, discontinue use.
</p>

<h3>2. Permitted Use</h3>
<ul>
  <li>You must own or have rights to uploaded files</li>
  <li>No illegal, infringing, or abusive use</li>
</ul>

<h3>3. Intellectual Property</h3>
<p>
You retain ownership of your files.
We retain ownership of the website, UI, and codebase.
</p>

<h3>4. Disclaimer</h3>
<p>
The service is provided “as is”.
No guarantees are made regarding accuracy, availability, or reliability.
</p>

<h3>5. Limitation of Liability</h3>
<p>
To the maximum extent allowed by law, RemoPDF is not liable for indirect or consequential damages.
</p>

<h3>6. Termination</h3>
<p>
We may suspend or terminate access at any time without notice.
</p>

<h3>7. Governing Law</h3>
<p>
These terms are governed by the laws of the operating jurisdiction.
</p>

<h3>8. Contact</h3>
<p>
<strong>Email:</strong>
<a href="mailto:tmsoftwaresprivacy@outlook.com">tmsoftwaresprivacy@outlook.com</a>
</p>
  `}overlayClose.onclick=()=>overlay.style.display="none",overlay.addEventListener("click",e=>{e.target===overlay&&(overlay.style.display="none")});const EMAILJS_SERVICE_ID="service_a7c5ag9",EMAILJS_TEMPLATE_ID="template_5bc1mt5",EMAILJS_PUBLIC_KEY="drD2CBWiRuBzQGBEO";window.emailjs?emailjs.init("drD2CBWiRuBzQGBEO"):console.warn("EmailJS not loaded; contact form will not send emails.");const contactOverlay=document.getElementById("contactOverlay"),contactForm=document.getElementById("contactForm"),contactError=document.getElementById("contactError"),sendContactBtn=document.getElementById("sendContact"),cancelContactBtn=document.getElementById("cancelContact"),overlayCloseButtons=document.querySelectorAll('.overlay-close[data-target="contactOverlay"], .overlay-close'),navContactLink=document.querySelector('.nav-right a[href="#"]'),toastContainer=document.getElementById("toastContainer");function showToast(e,t="success"){let a=toastContainer||document.getElementById("toastContainer")||document.body,l=document.createElement("div");l.className="toast"+("error"===t?" error":""),l.textContent=e,toastContainer||(l.style.position="fixed",l.style.top="16px",l.style.right="16px",l.style.zIndex="99999"),a.appendChild(l),setTimeout(()=>l.remove(),7e3)}function setContactError(e){if(contactError){if(!e){contactError.style.display="none",contactError.textContent="";return}contactError.style.display="block",contactError.textContent=e,contactError.setAttribute("role","alert")}}function openContactOverlay(){contactOverlay.style.display="flex",contactOverlay.setAttribute("aria-hidden","false");let e=contactOverlay.querySelector("input, textarea, button");e&&e.focus(),setContactError("")}function closeContactOverlay(){contactOverlay.style.display="none",contactOverlay.setAttribute("aria-hidden","true");let e=document.querySelector(".contact-open-btn")||document.querySelector('.nav-right a[href="#"]');e&&e.focus()}const contactLinks=Array.from(document.querySelectorAll(".nav-right a")).filter(e=>/contact/i.test(e.textContent));function validateContactForm(){let e=contactForm.name.value.trim(),t=contactForm.email.value.trim(),a=contactForm.message.value.trim();return e?t&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?!a||a.length<6?"Message must be at least 6 characters.":null:"Please enter a valid email address.":"Please enter your name."}async function downloadSplitZip(){if(splitData){downloadZipBtn.disabled=!0,showOverlayLoader("Preparing download","Packaging pages…");try{let{sourcePdf:e,baseName:t,splitMode:a,totalPages:l}=splitData,n=new JSZip,r=Array.from(splitPreview.querySelectorAll(".page-wrapper"));if("all"===a){let o=0;for(let i of r){o++,updateOverlayLoader(`Packaging page ${o} of ${r.length}`);let s=i.querySelector("div:last-child");if(!s)continue;let d=parseInt(s.textContent.replace("Page","").trim(),10)-1;if(isNaN(d)||d<0||d>=l||removedPages.has(d))continue;let c=await PDFLib.PDFDocument.create(),[p]=await c.copyPages(e,[d]);c.addPage(p),n.file(`${t}_page_${String(d+1).padStart(3,"0")}.pdf`,await c.save())}}else{let m=r.map(e=>{let t=e.querySelector("div:last-child");return t?parseInt(t.textContent.replace("Page","").trim(),10)-1:-1}).filter(e=>e>=0&&e<l&&!removedPages.has(e));if(!m.length){showToast("No pages left to download.","error");return}let u=await PDFLib.PDFDocument.create(),g=await u.copyPages(e,m);g.forEach(e=>u.addPage(e)),n.file(`${t}_pages.pdf`,await u.save())}let y=await n.generateAsync({type:"blob"});if(isAndroidWebView())await saveBlobAndroid(y,`${t}_split.zip`,"application/zip");else{let v=URL.createObjectURL(y),f=document.createElement("a");f.href=v,f.download=`${t}_split.zip`,document.body.appendChild(f),f.click(),f.remove(),URL.revokeObjectURL(v)}showToast("ZIP downloaded successfully.")}catch(h){console.error(h),showToast("Failed to create ZIP.","error")}finally{setTimeout(()=>{hideOverlayLoader()},1e3),downloadZipBtn.disabled=!1}}}async function openZoomView(e){let t=document.createElement("div");t.className="zoom-overlay";let a=document.createElement("button");a.className="zoom-close-btn",a.textContent="\xd7";let l=document.createElement("div");l.className="zoom-loader",l.innerHTML=`
    <div class="zoom-spinner"></div>
    <div>Loading preview</div>
    <small>Rendering page…</small>
  `,t.append(a,l),document.body.appendChild(t),a.onclick=()=>t.remove(),t.onclick=e=>{e.target===t&&t.remove()};let n;if("CANVAS"===e.tagName){let r=e.closest(".page-wrapper"),o=Number(r.dataset.pageNumber),i=r._pdfJsDoc,s=i.fingerprints?.[0]||"unknown",d=`${s}_${o}`;if(zoomCache.has(d)){let c=zoomCache.get(d),p=document.createElement("canvas");p.width=c.width,p.height=c.height,p.getContext("2d").drawImage(c,0,0),n=p}else{let m=document.createElement("canvas"),u=m.getContext("2d"),g=await i.getPage(o),y=window.innerWidth<768?1.5:2.2,v=g.getViewport({scale:y});m.width=v.width,m.height=v.height,await g.render({canvasContext:u,viewport:v}).promise,zoomCache.set(d,m),n=m}}else{let f=e.cloneNode(!0);f.classList.add("convert-zoom-image"),n=f}t.replaceChild(n,l)}function createInlineLoader(e="Processing…",t="Please wait…"){let a=document.createElement("div");return a.className="zoom-loader",a.style.display="flex",a.innerHTML=`
    <div class="zoom-spinner"></div>
    <div>${e}</div>
    <small>${t}</small>
  `,a}async function saveBlobAndroid(e,t,a){let l=new FileReader;return new Promise((n,r)=>{l.onerror=()=>r(l.error),l.onloadend=()=>{let e=l.result.split(",")[1];window.AndroidDownloader.saveFile(e,t,a),n()},l.readAsDataURL(e)})}function intersactionAd(){var e;(e=[document.documentElement,document.body].filter(Boolean).pop().appendChild(document.createElement("script"))).dataset.zone="10291964",e.src="https://groleegni.net/vignette.min.js"}contactLinks.length&&contactLinks.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),openContactOverlay()})}),cancelContactBtn.addEventListener("click",e=>{e.preventDefault(),setContactError(""),closeContactOverlay()}),contactOverlay.addEventListener("click",e=>{e.target===contactOverlay&&(setContactError(""),closeContactOverlay())}),Array.from(document.querySelectorAll(".overlay-close")).forEach(e=>{e.addEventListener("click",t=>{let a=e.getAttribute("data-target")||"";if(!a||"contactOverlay"===a){if(setContactError(""),"flex"===contactOverlay.style.display)closeContactOverlay();else{let l=document.getElementById("overlay");l&&(l.style.display="none")}}})}),contactForm.addEventListener("submit",e=>{e.preventDefault(),setContactError("");let t=validateContactForm();if(t){setContactError(t);return}sendContactBtn.disabled=!0,sendContactBtn.textContent="Sending...";let a={from_name:contactForm.name.value.trim(),from_email:contactForm.email.value.trim(),message:contactForm.message.value.trim()};if(!window.emailjs||!emailjs.send){setContactError("Email service unavailable. Please try again later."),sendContactBtn.disabled=!1,sendContactBtn.textContent="Send";return}emailjs.send("service_a7c5ag9","template_5bc1mt5",a).then(e=>{closeContactOverlay(),contactForm.reset(),showToast("Message sent. Thanks!","success")}).catch(e=>{console.error("EmailJS send error:",e),setContactError("Failed to send message. Please try again or email us directly."),showToast("Failed to send message.","error")}).finally(()=>{sendContactBtn.disabled=!1,sendContactBtn.textContent="Send"})}),document.addEventListener("keydown",e=>{if("Escape"===e.key){"flex"===contactOverlay.style.display&&(setContactError(""),closeContactOverlay());let t=document.getElementById("overlay");t&&"flex"===t.style.display&&(t.style.display="none")}}),contactOverlay.style.display="none",contactOverlay.setAttribute("aria-hidden","true"),setContactError(""),downloadZipBtn.addEventListener("click",async e=>{if(e.preventDefault(),"convert"===appMode){if(!lastZipBlobUrl){showToast("Nothing to download.","error");return}if(isAndroidWebView()){let t=await fetch(lastZipBlobUrl).then(e=>e.blob());await saveBlobAndroid(t,`pdf-images-${Date.now()}.zip`,"application/zip")}else{let a=document.createElement("a");a.href=lastZipBlobUrl,a.download=`pdf-images-${Date.now()}.zip`,document.body.appendChild(a),a.click(),a.remove()}return}"split"===appMode&&await downloadSplitZip()}),function e(){let t=[{name:"JSZip",test:()=>window.JSZip},{name:"PDF.js",test:()=>window.pdfjsLib},{name:"PDF-Lib",test:()=>window.PDFLib},].filter(e=>!e.test());t.length>0&&function e(){let t=document.getElementById("libErrorOverlay"),a=document.getElementById("retryLoadBtn");t&&(t.style.display="flex",t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",a.onclick=()=>{location.reload()})}()}(),renderFileListSummary();
  /* https://javascript-minifier.com/ */